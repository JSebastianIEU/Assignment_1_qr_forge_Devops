<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>QR Forge</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <h1>QR Forge</h1>

  <form id="form">
    <input name="title" placeholder="Title" required />
    <input name="url" placeholder="https://example.com" required />
    <button type="submit">Create QR</button>
  </form>

  <div class="actions">
    <button id="export">Export CSV</button>
  </div>

  <table id="table">
    <thead><tr><th>Title</th><th>URL</th><th>Created</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>

<script>
async function refresh(){
  const res = await fetch('/api/qr');
  const data = await res.json();
  const tbody = document.querySelector('#table tbody');
  tbody.innerHTML = '';
  data.forEach(item => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item.title}</td>
      <td><a href="${item.url}" target="_blank">${item.url}</a></td>
      <td>${new Date(item.created_at).toLocaleString()}</td>
      <td>
        <a href="/api/qr/${item.id}/download">Download SVG</a>
        <button data-id="${item.id}" class="del">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
  document.querySelectorAll('.del').forEach(b=>{
    b.onclick = async () => {
      await fetch('/api/qr/'+b.dataset.id, {method:'DELETE'});
      refresh();
    }
  });
}
document.getElementById('form').onsubmit = async (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  await fetch('/api/qr', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ title: fd.get('title'), url: fd.get('url') })
  });
  e.target.reset();
  refresh();
};
document.getElementById('export').onclick = ()=>{ window.location='/api/export/csv' }
refresh();
</script>
</body>
</html>
